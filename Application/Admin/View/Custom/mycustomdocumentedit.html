<extend name="Public/base"/>

<block name="body">
<script type="text/javascript">
	var path='__MODULE__';
	var url='__URL__';
</script>
<script src="__JS__/swfupload/swfupload.js" type="text/javascript"></script>
<script src="__JS__/swfupload/swfupload.swfobject.js" type="text/javascript"></script>
<script src="__JS__/swfupload/swfupload.queue.js" type="text/javascript"></script>
<script src="__JS__/swfupload/fileprogress.js" type="text/javascript"></script>
<script src="__JS__/swfupload/handlers.js" type="text/javascript"></script>
<script src="__JS__/swfupload/swfupload.cookies.js" type="text/javascript"></script>
<link href="__JS__/swfupload/default.css" rel="stylesheet" type="text/css">
<script type="text/javascript">
		
		var swfu;
        SWFUpload.onload = function () {
            var settings = {
                flash_url: "__JS__/swfupload/swfupload.swf",
                upload_url: "{:U('Custom/myCustomDocumentUpload')}",
                post_params: {},
                file_size_limit: "10 MB",
                file_types: "*.jpg;*.gif;*.png;*.rar;*.zip;*.txt;*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.bmp;*.pdf",   //限制文件类型：*.jpg;*.gif;*.png
                file_types_description: "All Files",
                file_upload_limit: 10,   //限制上传文件数目
                file_queue_limit: 0,     //限制每次选择文件的数目，0为不限制
                custom_settings: {
                    progressTarget: "divFileProgressContainer",
                    cancelButtonId: "btnCancel"
                },
                // Button Settings
                button_image_url: "__IMG__/upload.png",
                button_placeholder_id: "spanButtonPlaceholder",
                button_width: 80,
				button_height:33,
                debug: false, //开启调试模式
                // The event handler functions are defined in handlers.js
                swfupload_loaded_handler: swfUploadLoaded,
                file_queued_handler: fileQueued,
                file_queue_error_handler: fileQueueError,
                file_dialog_complete_handler: fileDialogComplete,
                upload_start_handler: uploadStart,
                upload_progress_handler: uploadProgress,
                upload_error_handler: uploadError,
                upload_success_handler: uploadSuccess,
                upload_complete_handler: uploadComplete,
                queue_complete_handler: queueComplete, // Queue plugin event

                // SWFObject settings
                minimum_flash_version: "9.0.28",
                swfupload_pre_load_handler: swfUploadPreLoad,
                swfupload_load_failed_handler: swfUploadLoadFailed
            };
            swfu = new SWFUpload(settings);
        }
	</script>

    <div class="main-title">
        <h2>新增合同文档</h2>
    </div>
    <form action="{:U('Custom/myCustomDocumentAdd')}" method="post" class="form-horizontal" enctype="multipart/form-data">
    	<foreach name="_doc" item="dc">
    	<div class="form-item">
            <label class="item-label">文档名称</label>
            <div class="controls">
                <input type="text" class="text" name="document_name" value="{$dc.document_name}">
            </div>
        </div>
        <div class="form-item">
            <label class="item-label">文档类别</label>
            <div class="controls">
                <select name="document_type" style="width:230px;height:29px;" class="text">
                    <option value="合同文档" {$dc['document_type'] == '合同文档'? 'selected' : ''}>合同文档</option>
                    <option value="其他文档" {$dc['document_type'] == '其他文档'? 'selected' : ''}>其他文档</option>
                </select>
            </div>
        </div>
        <div class="form-item">
            <label class="item-label">文档描述</label>
            <div class="controls">
                <textarea name="document_explain" rows="4" cols="40">{$dc.document_explain}</textarea>
            </div>
        </div>
		<div style="width: 356px; height: auto; border: 1px solid #e1e1e1; font-size: 12px; padding: 10px;margin: 10px;">
		<label class="item-label">相关附件：</label>
		
		<div id="divFileProgressContainer" style="width:300px">
        <p><span id="spanButtonPlaceholder"></span>&nbsp;|&nbsp;<span id="divStatus">0</span> 个文件已经上传

        <foreach name="dc.document_path" item="vi" key="k">
		<div class="progressContainer blue"><a class="progressCancel" href="#" style="visibility: visible;"> </a>
		<div class="progressName">{$vi}</div>
		<div class="progressBarStatus">
		<span class="completeMsg">上传完成</span></div><div class="progressBarComplete"></div>
		<input type="hidden" value="{$k}" id="value_SWFUpload_0_0" name="fileUrl"></div>
		</foreach>
        
        <input id="btnCancel" type="hidden" value="取消所有" disabled="disabled" style="margin-left: 2px; height: 22px; font-size: 8pt;" /></p>
        <div class="flash" id="fsUploadProgress"></div>
        </div>
        <div style="clear:both;"></div>
        <input type="hidden" name="hfFiles" id="hfFiles" />
        <span id="fileIds" style="display:none"></span>
		
		<input type="hidden" name="document_path" id="document_path" value=""/>
		<input type="hidden" name="customer_number" value="{$dc.customer_number}" />
		<input type="hidden" name="customer_name" value="{$dc.customer_name}"/>
		</div>
		</foreach>
        <div class="form-item">
        <!-- 有ajax     -->
        	
        	<button class="btn submit-btn ajax-post" id="submit" type="submit" target-form="form-horizontal" onclick="getValue();">保存</button>
            <button class="btn btn-return" onclick="javascript:history.back(-1);return false;">取消</button>
        </div>
    </form>
</block>

<block name="script">
<script src="__STATIC__/select.js"></script>
<script type="text/javascript" defer>
    function change(){
    	var sel = document.getElementById('contact_way');
    	var way = ['手机','固定电话','QQ','微信'];
    	var way_name = '手机';
    	for(var i=0,len=way.length; i<len; i++){
    		if(way[i] == sel.value){
    			way_name = way[i];
    		}
    	}
    	document.getElementById('way_name').innerHTML = way_name;
    }
    
    function getValue(){
    	var value = document.getElementsByName('fileUrl');
		var document_path = document.getElementById('document_path');
		var path = '';
    	for(var i=0; i<value.length; i++){
			path += '|' + value[i].value;
		}
    	$('#document_path').val(path);
    }
    
  //导航高亮
    highlight_subnav('{:U('Custom/customList')}');
</script>
</block>

